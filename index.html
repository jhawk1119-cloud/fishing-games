<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Clicker Fishing Game - Expanded</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #f0f8ff; /* Light blue background for water */
            margin: 0;
            color: #333;
        }

        #game-container {
            background: #fff;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            text-align: center;
            width: 90%;
            max-width: 500px;
            margin-bottom: 20px;
        }

        #fishing-button {
            padding: 15px 30px;
            font-size: 20px;
            cursor: pointer;
            background-color: #4CAF50; /* Green button */
            color: white;
            border: none;
            border-radius: 8px;
            transition: background-color 0.3s, transform 0.1s;
        }

        #fishing-button:hover {
            background-color: #45a049;
        }

        #fishing-button:active {
            transform: scale(0.98);
        }

        #result {
            margin-top: 20px;
            font-size: 18px;
            min-height: 50px; /* Reserve space */
        }

        #inventory, #money-display, #current-rod {
            margin-top: 15px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
            text-align: left;
            background: #fafafa;
        }

        #money-display {
            font-size: 1.2em;
            font-weight: bold;
            color: #2196F3;
            text-align: center;
        }
        
        #current-rod {
            font-size: 0.9em;
            text-align: center;
            background-color: #e0f7fa;
        }

        /* Rarity Classes (UPDATED) */
        .rarity-common { color: #555; }
        .rarity-uncommon { color: #008000; }
        .rarity-rare { color: #0000ff; }
        .rarity-epic { color: #a020f0; } 
        .rarity-legendary { color: #800080; }
        .rarity-mythic { color: #ff8c00; }
        /* NEW RARITIES */
        .rarity-depthful { color: #005f73; font-weight: bold; } /* Dark Teal/Ocean Blue */
        .rarity-ethereal { color: #9d4edd; font-weight: bold; } /* Purple/Magenta */
        .rarity-cosmic { color: #ff006e; font-weight: bold; } /* Bright Pink/Crimson */
        .rarity-exotic { color: #ffd700; } 
        .rarity-secret { color: #ff69b4; }
        .rarity-apex { color: #dc143c; }


        /* --- Shop/Button Styles --- */
        #shop-button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
        }
        
        #button-group {
            display: flex;
            justify-content: center;
            margin-top: 15px;
            gap: 10px; /* Space between the two main buttons */
        }
        
        #sell-all-button {
            padding: 8px 15px;
            font-size: 14px;
            cursor: pointer;
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            margin-top: 5px;
            width: 100%;
        }

        /* --- Shop Overlay Styles --- */
        #shop-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        #shop-box {
            background: #fff;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.8);
            max-height: 80vh;
            overflow-y: auto;
        }

        .rod-item {
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .rod-stats span {
            margin-right: 10px;
            font-size: 0.9em;
            color: #555;
        }

        .buy-button {
            padding: 8px 15px;
            cursor: pointer;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            transition: background-color 0.2s;
            min-width: 90px;
        }

        .buy-button:hover:not(:disabled) {
            background-color: #218838;
        }
        
        .buy-button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        
        .equipped-label {
            color: #007bff;
            font-weight: bold;
            min-width: 90px;
        }
        
        /* --- Mini-Game Overlay Styles (Kept for completeness) --- */
        #minigame-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        #minigame-box {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }

        #progress-bar-container {
            width: 250px;
            height: 20px;
            background-color: #eee;
            border-radius: 10px;
            margin: 15px auto;
            position: relative;
            border: 1px solid #aaa;
        }

        #progress-bar {
            height: 100%;
            width: 0%;
            background-color: #4CAF50;
            border-radius: 10px;
            transition: width 0.1s linear;
        }

        #target-area {
            position: absolute;
            height: 100%;
            background-color: rgba(255, 0, 0, 0.4);
            left: 50%; /* Example position */
            width: 20%; /* Example size */
            top: 0;
            border-left: 2px solid red;
            border-right: 2px solid red;
        }

        #minigame-button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            margin-top: 10px;
        }
    </style>
</head>
<body>

<div id="game-container">
    <h2>üåä Ultimate Clicker Fishing Game üêü</h2>
    
    <div id="money-display">üí∞ Money: $0</div>
    
    <div id="current-rod">
        üé£ Current Rod: <span id="rod-name">Basic Rod</span> (Luck: <span id="rod-luck">0</span>, Lure Speed: <span id="rod-speed">1.0x Reel Progress</span>)
    </div>

    <div id="button-group">
        <button id="fishing-button">Click to Fish!</button>
        <button id="shop-button">üõí Open Shop</button>
    </div>

    <div id="result">Waiting for a bite...</div>

    <div id="inventory">
        <h3>Inventory</h3>
        <ul id="fish-list">
            </ul>
        <button id="sell-all-button">Sell All Fish</button>
    </div>
</div>

<div id="shop-overlay">
    <div id="shop-box">
        <h3>üõí Fishing Rod Shop</h3>
        <p>Buy better rods to increase your **Luck** (better chance for rare fish) and **Lure Speed** (more catch progress per successful reel click).</p>
        <div id="shop-items-list">
            </div>
        <button class="buy-button" style="background-color: #6c757d;" onclick="closeShop()">Close Shop</button>
    </div>
</div>

<div id="minigame-overlay">
    <div id="minigame-box">
        <h3>Mini-Game: Reel it In!</h3>
        <p>Click the button repeatedly when the progress bar is inside the **red target zone** to catch the fish!</p>
        
        <div id="progress-bar-container">
            <div id="target-area"></div>
            <div id="progress-bar"></div>
        </div>

        <p id="minigame-feedback"></p>
        <button id="minigame-button">REEL!</button>
    </div>
</div>

<script>
    // --- Configuration ---
    const RARITIES = [
        // Includes the 'value' for selling fish (Updated Chances and Values)
        { name: 'Common', chance: 70, colorClass: 'rarity-common', value: 10 },
        { name: 'Uncommon', chance: 15, colorClass: 'rarity-uncommon', value: 30 },
        { name: 'Rare', chance: 8, colorClass: 'rarity-rare', value: 80 },
        { name: 'Epic', chance: 3, colorClass: 'rarity-epic', value: 250 }, 
        { name: 'Legendary', chance: 2, colorClass: 'rarity-legendary', value: 750 },
        { name: 'Mythic', chance: 1, colorClass: 'rarity-mythic', value: 2000 },
        // NEW RARITIES
        { name: 'Depthful', chance: 0.5, colorClass: 'rarity-depthful', value: 5000 },
        { name: 'Ethereal', chance: 0.25, colorClass: 'rarity-ethereal', value: 15000 },
        { name: 'Cosmic', chance: 0.1, colorClass: 'rarity-cosmic', value: 50000 },
        // Adjusted top tiers
        { name: 'Exotic', chance: 0.05, colorClass: 'rarity-exotic', value: 150000 },
        { name: 'Secret', chance: 0.03, colorClass: 'rarity-secret', value: 400000 },
        { name: 'Apex', chance: 0.02, colorClass: 'rarity-apex', value: 1000000 },
    ].sort((a, b) => b.chance - a.chance);

    const FISH_NAMES = {
        'Common': ['Minnow', 'Trout', 'Bass', 'Sardine'],
        'Uncommon': ['Perch', 'Carp', 'Catfish', 'Haddock'],
        'Rare': ['Salmon', 'Eel', 'Pike', 'Halibut'],
        'Epic': ['Mahi-Mahi', 'Kingfish', 'Barracuda', 'Grouper'], 
        'Legendary': ['Blue Marlin', 'Swordfish', 'Giant Squid'],
        'Mythic': ['Kraken Trout', 'Sunken Shark', 'Nessie Bass'],
        // NEW FISH NAMES
        'Depthful': ['Shadow Fin', 'Glow Whale', 'Deep Sea Angler'],
        'Ethereal': ['Whisper Eel', 'Astral Shrimp', 'Phantom Flounder'],
        'Cosmic': ['Stardust Ray', 'Nebula Tetra', 'Galactic Grouper'],
        'Exotic': ['Abyssal Dragonfish', 'Void Ray', 'Crystal Cod'],
        'Secret': ['Cosmic Jellyfish', 'Ethereal Blob'],
        'Apex': ['Primordial Leviathan', 'Oceanius Rex'],
    };
    
    // Rods with Luck and Lure Speed Multiplier stats (New rods added)
    const FISHING_RODS = [
        { id: 'basic', name: 'Basic Rod', cost: 0, luck: 0, lureSpeedMultiplier: 1.0 },
        { id: 'wood', name: 'Wooden Rod', cost: 100, luck: 5, lureSpeedMultiplier: 1.2 },
        { id: 'steel', name: 'Steel Rod', cost: 500, luck: 10, lureSpeedMultiplier: 1.5 },
        { id: 'carbon', name: 'Carbon Rod', cost: 2500, luck: 20, lureSpeedMultiplier: 2.0 },
        { id: 'titanium', name: 'Titanium Rod', cost: 10000, luck: 40, lureSpeedMultiplier: 2.5 },
        { id: 'diamond', name: 'Diamond Rod', cost: 50000, luck: 75, lureSpeedMultiplier: 3.5 },
        { id: 'master', name: 'Master Rod', cost: 150000, luck: 120, lureSpeedMultiplier: 5.0 },
        { id: 'quantum', name: 'Quantum Rod', cost: 500000, luck: 200, lureSpeedMultiplier: 7.0 }, // New Rod
        { id: 'celestial', name: 'Celestial Rod', cost: 1500000, luck: 350, lureSpeedMultiplier: 10.0 }, // New Rod
    ];

    // --- State Variables ---
    let money = 0; 
    let currentRod = FISHING_RODS[0];
    const ownedRods = new Set(['basic']);
    const inventory = {};
    let minigameActive = false;
    let minigameInterval;
    let currentFishRarity = null;
    
    // --- DOM Elements ---
    const fishingButton = document.getElementById('fishing-button');
    const shopButton = document.getElementById('shop-button');
    const sellAllButton = document.getElementById('sell-all-button');
    const resultDiv = document.getElementById('result');
    const fishList = document.getElementById('fish-list');
    const minigameOverlay = document.getElementById('minigame-overlay');
    const minigameButton = document.getElementById('minigame-button');
    const progressBar = document.getElementById('progress-bar');
    const targetArea = document.getElementById('target-area');
    const minigameFeedback = document.getElementById('minigame-feedback');
    const moneyDisplay = document.getElementById('money-display'); 
    const rodNameSpan = document.getElementById('rod-name'); 
    const rodLuckSpan = document.getElementById('rod-luck'); 
    const rodSpeedSpan = document.getElementById('rod-speed'); 
    const shopItemsList = document.getElementById('shop-items-list'); 

    // --- Minigame Variables ---
    let progress = 0;
    let barDirection = 1;
    const BASE_BAR_SPEED = 2.5; // Fixed bar movement speed
    const BASE_REEL_INCREMENT = 5; // Base catch progress gain
    const CATCH_THRESHOLD = 100;

    // --- Core Functions ---
    
    function updateMoneyDisplay() {
        moneyDisplay.textContent = `üí∞ Money: $${money.toFixed(2)}`;
        updateShopDisplay();
    }
    
    function updateRodDisplay() {
        rodNameSpan.textContent = currentRod.name;
        rodLuckSpan.textContent = currentRod.luck;
        // Display the multiplier instead of the bar speed
        rodSpeedSpan.textContent = `${currentRod.lureSpeedMultiplier.toFixed(1)}x Reel Progress`; 
    }

    function getFishRarity() {
        // Calculate the total modified chance
        const modifiedRarities = RARITIES.map(r => {
            if (r.name === 'Common') {
                // Luck decreases Common chance
                return { ...r, chance: Math.max(1, r.chance - currentRod.luck * 0.5) }; 
            } else if (r.name !== 'Uncommon') {
                // Luck increases Rare and above chance
                return { ...r, chance: r.chance + (currentRod.luck / 8) };
            }
            return r; 
        });

        const totalModifiedChance = modifiedRarities.reduce((sum, item) => sum + item.chance, 0);
        let random = Math.random() * totalModifiedChance;

        for (const item of modifiedRarities) {
            if (random < item.chance) {
                // Return the original rarity object (for original value and color class)
                return RARITIES.find(r => r.name === item.name); 
            }
            random -= item.chance;
        }
        return RARITIES[0]; // Fallback
    }

    function getFishName(rarityName) {
        const names = FISH_NAMES[rarityName];
        return names[Math.floor(Math.random() * names.length)];
    }

    function startFishing() {
        if (minigameActive) return;

        fishingButton.disabled = true;
        resultDiv.textContent = 'Reeling in...';
        currentFishRarity = getFishRarity();
        
        setTimeout(startMiniGame, 1500);
    }

    function startMiniGame() {
        minigameActive = true;
        minigameOverlay.style.display = 'flex';
        progressBar.style.width = '0%';
        progress = 50;
        barDirection = 1;
        minigameFeedback.textContent = 'Keep the bar in the red zone!';

        // Randomize the target area
        const targetSize = 20 + Math.random() * 10;
        const targetPos = 10 + Math.random() * (100 - targetSize - 10);
        targetArea.style.width = `${targetSize}%`;
        targetArea.style.left = `${targetPos}%`;
        targetArea.targetLeft = targetPos;
        targetArea.targetRight = targetPos + targetSize;
        
        // Start the bar movement loop (using fixed base speed)
        minigameInterval = setInterval(updateMiniGame, 50);
    }

    function updateMiniGame() {
        // Bar movement logic remains consistent
        progress += BASE_BAR_SPEED * barDirection;
        if (progress >= 100 || progress <= 0) {
            barDirection *= -1; 
            progress = Math.max(0, Math.min(100, progress));
        }
        progressBar.style.width = `${progress}%`;
    }

    function reelAction() {
        if (!minigameActive) return;

        const isTargeted = progress >= targetArea.targetLeft && progress <= targetArea.targetRight;
        
        // Calculate progress gain using the rod's multiplier
        const progressGain = BASE_REEL_INCREMENT * currentRod.lureSpeedMultiplier;

        if (isTargeted) {
            progressBar.catchProgress = (progressBar.catchProgress || 0) + progressGain;
            minigameFeedback.textContent = `HIT! Catch Progress: ${progressBar.catchProgress.toFixed(0)}% (+${progressGain.toFixed(1)})`;
            
            if (progressBar.catchProgress >= CATCH_THRESHOLD) {
                endMiniGame(true);
            }
        } else {
            // Loss rate is still based on the base increment for difficulty
            progressBar.catchProgress = Math.max(0, (progressBar.catchProgress || 0) - BASE_REEL_INCREMENT * 2);
            minigameFeedback.textContent = `MISS! Catch Progress: ${progressBar.catchProgress.toFixed(0)}%`;
        }
    }

    function endMiniGame(success) {
        clearInterval(minigameInterval);
        minigameActive = false;
        minigameOverlay.style.display = 'none';
        fishingButton.disabled = false;
        delete progressBar.catchProgress;

        if (success) {
            const fishName = getFishName(currentFishRarity.name);
            const message = `You successfully caught a <span class="${currentFishRarity.colorClass}">${currentFishRarity.name} ${fishName}!</span>`;
            resultDiv.innerHTML = message;
            addToInventory(currentFishRarity.name, fishName);
        } else {
            resultDiv.textContent = 'The fish got away! Try again.';
        }
    }

    function addToInventory(rarity, name) {
        const key = `${rarity}:${name}`;
        inventory[key] = (inventory[key] || 0) + 1;
        updateInventoryDisplay();
    }

    function updateInventoryDisplay() {
        fishList.innerHTML = '';
        const rarityOrder = RARITIES.map(r => r.name);
        
        // Sort keys by rarity order (rarest first)
        const sortedKeys = Object.keys(inventory).sort((a, b) => {
            const rarityA = a.split(':')[0];
            const rarityB = b.split(':')[0];
            return rarityOrder.indexOf(rarityB) - rarityOrder.indexOf(rarityA);
        });

        for (const key of sortedKeys) {
            const [rarity, name] = key.split(':');
            const count = inventory[key];
            const rarityItem = RARITIES.find(r => r.name === rarity);
            const colorClass = rarityItem ? rarityItem.colorClass : '';
            const value = rarityItem ? rarityItem.value : 0;

            const li = document.createElement('li');
            li.innerHTML = `<span class="${colorClass}">${rarity} ${name}</span> x${count} **($${value}/ea)**`;
            fishList.appendChild(li);
        }
        
        sellAllButton.disabled = Object.keys(inventory).length === 0;
    }
    
    function sellAllFish() {
        if (Object.keys(inventory).length === 0) {
            resultDiv.textContent = "Your inventory is empty!";
            return;
        }

        let totalValue = 0;
        let fishSold = 0;

        for (const key in inventory) {
            const [rarity] = key.split(':');
            const count = inventory[key];
            const rarityItem = RARITIES.find(r => r.name === rarity);
            const value = rarityItem ? rarityItem.value : 0;

            totalValue += count * value;
            fishSold += count;
            delete inventory[key]; // Clear inventory after selling
        }

        money += totalValue;
        
        resultDiv.textContent = `üí∞ Sold ${fishSold} fish for $${totalValue.toFixed(2)}!`;
        updateInventoryDisplay();
        updateMoneyDisplay();
    }
    
    // --- Shop Functions ---
    
    function openShop() {
        document.getElementById('shop-overlay').style.display = 'flex';
        updateShopDisplay();
    }
    
    function closeShop() {
        document.getElementById('shop-overlay').style.display = 'none';
    }
    
    function updateShopDisplay() {
        shopItemsList.innerHTML = '';
        
        FISHING_RODS.forEach(rod => {
            const isOwned = ownedRods.has(rod.id);
            const isEquipped = currentRod.id === rod.id;
            const canAfford = money >= rod.cost;
            
            const rodDiv = document.createElement('div');
            rodDiv.className = 'rod-item';
            
            let buttonHTML;
            if (isEquipped) {
                buttonHTML = `<span class="equipped-label">EQUIPPED</span>`;
            } else if (isOwned) {
                buttonHTML = `<button class="buy-button" onclick="equipRod('${rod.id}')">Equip</button>`;
            } else {
                buttonHTML = `<button class="buy-button" ${!canAfford ? 'disabled' : ''} onclick="buyRod('${rod.id}', ${rod.cost})">Buy ($${rod.cost})</button>`;
            }
            
            rodDiv.innerHTML = `
                <div>
                    <strong>${rod.name}</strong> 
                    <div class="rod-stats">
                        <span>LUCK: +${rod.luck}</span>
                        <span>REEL SPEED: x${rod.lureSpeedMultiplier.toFixed(1)}</span>
                    </div>
                </div>
                ${buttonHTML}
            `;
            
            shopItemsList.appendChild(rodDiv);
        });
    }
    
    function buyRod(rodId, cost) {
        const rod = FISHING_RODS.find(r => r.id === rodId);
        
        if (money >= cost) {
            money -= cost;
            ownedRods.add(rodId);
            currentRod = rod; // Auto-equip
            
            alert(`You bought the ${rod.name} and equipped it!`);
            
            updateMoneyDisplay();
            updateRodDisplay();
            updateShopDisplay();
        } else {
            alert("Not enough money to buy this rod!");
        }
    }
    
    function equipRod(rodId) {
        const rod = FISHING_RODS.find(r => r.id === rodId);
        if (ownedRods.has(rodId)) {
            currentRod = rod;
            updateRodDisplay();
            updateShopDisplay();
        }
    }
    
    // --- Event Listeners and Initial Setup ---
    fishingButton.addEventListener('click', startFishing);
    minigameButton.addEventListener('click', reelAction);
    sellAllButton.addEventListener('click', sellAllFish);
    shopButton.addEventListener('click', openShop);

    // Make the buy/equip functions globally accessible from the shop buttons
    window.openShop = openShop;
    window.closeShop = closeShop;
    window.buyRod = buyRod;
    window.equipRod = equipRod;

    // Initial game setup
    updateMoneyDisplay();
    updateRodDisplay();
    updateInventoryDisplay();
</script>

</body>
</html>